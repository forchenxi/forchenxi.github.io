<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="deep learning,pytorch,yolov3,模板匹配,OCR,">










<meta name="description" content="关于中文点选验证码的识别背景描述之前对yolov3学习了挺多，包括Keras和Pytorch版本的框架代码都有使用过，而且还针对网易易盾的滑块验证码做过训练和识别，因为整体上所有滑块仅可看作一类目标，所以任务比较简单；接下来打算对网易易盾的文字点选验证码进行尝试，其中又分为有语序要求和无语序要求的两类。 无语序要求 无语序要求的就是一张验证码图片上给4~5个字，然后再给你三个字，让你按顺序点击。">
<meta name="keywords" content="deep learning,pytorch,yolov3,模板匹配,OCR">
<meta property="og:type" content="article">
<meta property="og:title" content="关于中文点选验证码的识别">
<meta property="og:url" content="http://yoursite.com/2021/08/14/dl-word-click/index.html">
<meta property="og:site_name" content="Sunrise">
<meta property="og:description" content="关于中文点选验证码的识别背景描述之前对yolov3学习了挺多，包括Keras和Pytorch版本的框架代码都有使用过，而且还针对网易易盾的滑块验证码做过训练和识别，因为整体上所有滑块仅可看作一类目标，所以任务比较简单；接下来打算对网易易盾的文字点选验证码进行尝试，其中又分为有语序要求和无语序要求的两类。 无语序要求 无语序要求的就是一张验证码图片上给4~5个字，然后再给你三个字，让你按顺序点击。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2021/08/14/dl-word-click/click1.jpg">
<meta property="og:image" content="http://yoursite.com/2021/08/14/dl-word-click/click2.jpg">
<meta property="og:image" content="http://yoursite.com/2021/08/14/dl-word-click/pred.jpg">
<meta property="og:updated_time" content="2022-03-11T12:04:38.149Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关于中文点选验证码的识别">
<meta name="twitter:description" content="关于中文点选验证码的识别背景描述之前对yolov3学习了挺多，包括Keras和Pytorch版本的框架代码都有使用过，而且还针对网易易盾的滑块验证码做过训练和识别，因为整体上所有滑块仅可看作一类目标，所以任务比较简单；接下来打算对网易易盾的文字点选验证码进行尝试，其中又分为有语序要求和无语序要求的两类。 无语序要求 无语序要求的就是一张验证码图片上给4~5个字，然后再给你三个字，让你按顺序点击。">
<meta name="twitter:image" content="http://yoursite.com/2021/08/14/dl-word-click/click1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/08/14/dl-word-click/">





  <title>关于中文点选验证码的识别 | Sunrise</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sunrise</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">`长路漫漫，唯剑作伴`</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/08/14/dl-word-click/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="chenxi">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sunrise">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">关于中文点选验证码的识别</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-08-14T11:10:54+08:00">
                2021-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/深度学习/" itemprop="url" rel="index">
                    <span itemprop="name">深度学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="关于中文点选验证码的识别"><a href="#关于中文点选验证码的识别" class="headerlink" title="关于中文点选验证码的识别"></a>关于中文点选验证码的识别</h2><h2 id="背景描述"><a href="#背景描述" class="headerlink" title="背景描述"></a>背景描述</h2><p>之前对<code>yolov3</code>学习了挺多，包括<code>Keras</code>和<code>Pytorch</code>版本的框架代码都有使用过，而且还针对网易易盾的滑块验证码做过训练和识别，因为整体上所有滑块仅可看作一类目标，所以任务比较简单；接下来打算对网易易盾的文字点选验证码进行尝试，其中又分为有语序要求和无语序要求的两类。</p>
<h3 id="无语序要求"><a href="#无语序要求" class="headerlink" title="无语序要求"></a>无语序要求</h3><p><img src="/2021/08/14/dl-word-click/click1.jpg" alt></p>
<p>无语序要求的就是一张验证码图片上给4~5个字，然后再给你三个字，让你按顺序点击。</p>
<h3 id="有语序要求"><a href="#有语序要求" class="headerlink" title="有语序要求"></a>有语序要求</h3><p><img src="/2021/08/14/dl-word-click/click2.jpg" alt></p>
<p>有语序要求的就是一张验证码图片上给4~5个字，但是不再直接给出让你点击的文字，而是<strong>让你根据语义顺序点击，一般是一个成语(词语)或古诗</strong>(古文里的句子，比如这里”感时花溅泪”)，成语的话比较简单，利用结巴分词一般就可以解决，古诗不太好弄。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><a id="more"></a>
<p>针对文字点选类型的验证码，首先我们应该可以想到关于有语序要求的这种，实际上就涉及<code>NLP</code>自然语言处理领域的技术了，所以理论上我们应该把问题的解决分为两个大的阶段</p>
<ul>
<li><p>第一阶段</p>
<p>把图片中的每个文字的位置定位到，并且分别识别出来每个位置的字是什么，这个是计算机视觉方面的技术；</p>
</li>
<li><p>第二阶段</p>
<p>如果是有语序要求的验证码，要通过<code>NLP</code>方面的技术去解决，若无语序要求那就没有第二阶段。</p>
</li>
</ul>
<p>我们可以清楚地意识到，第一阶段和第二阶段用到的技术栈相当于是完全不同的，这篇文章会介绍下关于第一阶段的一些解决思路（大部分是理论）。第二阶段会用另一篇文章<strong>分词</strong>相关的来单独介绍。</p>
<p>根据第一阶段工作目标的描述，我们很容易就想到两种方案。</p>
<h3 id="方案一："><a href="#方案一：" class="headerlink" title="方案一："></a>方案一：</h3><h4 id="第一步：先定位文字，也就是仅做目标检测，所有文字认为是1类"><a href="#第一步：先定位文字，也就是仅做目标检测，所有文字认为是1类" class="headerlink" title="第一步：先定位文字，也就是仅做目标检测，所有文字认为是1类"></a>第一步：先定位文字，也就是仅做目标检测，所有文字认为是1类</h4><p>这一步<code>yolov3</code>可以轻松将问题解决，我只使用100张数据集图片就得到了一个比较不错的检测模型;</p>
<p><img src="/2021/08/14/dl-word-click/pred.jpg" alt></p>
<h4 id="第二步：对定位区域进行切割（把字抠出来），单个文字进行识别"><a href="#第二步：对定位区域进行切割（把字抠出来），单个文字进行识别" class="headerlink" title="第二步：对定位区域进行切割（把字抠出来），单个文字进行识别"></a>第二步：对定位区域进行切割（把字抠出来），单个文字进行识别</h4><p><em>注意点：有些文字的角度可能不正，后面识别的时候可能需要旋转；</em></p>
<p>关于单个文字的识别方式，我能想到这样几种方式：</p>
<ul>
<li><p>利用识别普通的字符验证码（只包括字母和数字）的方式我觉得应该也是可以，只不过类别更多（几千个常见文字），相应的需要的数据集更多！需要的神经网络深度更深！</p>
</li>
<li><p>还有一种比较取巧的方式——模板匹配，<strong>这个方案有个前提是验证码图片里要给出想让你点的文字</strong></p>
<p>这也分两种情况：</p>
<p>1、验证码图片上既给了可以点击的若干个汉字，又给了想让你点击的汉字(就像上面那张图一样)，也就是说你实际上也是不知道让你点的文字是什么，这个的意思是你的程序不知道（可能比较绕，希望你能懂），除非你把两个区域的文字都进行识别；</p>
<p>这个时候你就可以拿需要点的文字去图中匹配（<code>opencv</code>中有可用的模板匹配方法，我前面的文章也有介绍使用过），这种一般在两个区域文字字体比较相似的时候，效果好一些。</p>
<p>2、你能通过网站直接获取到让你点击的文字，意思的是你的程序可以获取到具体的文字，那你就可以自己将文字生成到图片中，按照可以点击的汉字字体来生成，这个就需要你能找到究竟是什么字体。</p>
<p>还有其他类似相似度匹配的方法也是这样一个原理。</p>
</li>
<li><p>OCR识别，按照经验普通的字符验证码识别网络肯定得到的准确率不是很高，所以才会有一系列OCR识别的特殊网络被研究出来，关于OCR在文章后面的地方会单独介绍。</p>
<p>当然现在已经有一些通用的OCR识别接口（可能需要收费）或者模块（例如<code>muggle</code>），可以直接拿来用，针对那种字体比较“端正”，背景干扰比较少的情况，这个方法还是可行的。</p>
</li>
</ul>
<h4 id="第三步：返回相应文字的坐标（像素点）"><a href="#第三步：返回相应文字的坐标（像素点）" class="headerlink" title="第三步：返回相应文字的坐标（像素点）"></a>第三步：返回相应文字的坐标（像素点）</h4><h3 id="方案二："><a href="#方案二：" class="headerlink" title="方案二："></a>方案二：</h3><h4 id="第一步：定位-分类同时实现，那就要做一个几千个类别的目标检测和分类模型"><a href="#第一步：定位-分类同时实现，那就要做一个几千个类别的目标检测和分类模型" class="headerlink" title="第一步：定位+分类同时实现，那就要做一个几千个类别的目标检测和分类模型"></a>第一步：定位+分类同时实现，那就要做一个几千个类别的目标检测和分类模型</h4><p>这时候第一想到的可能也是<code>yolov3</code>，因为<code>yolov3</code>本身就是支持目标检测+分类的算法，但是这样一个几千个类别应该不行，yolov3应该默认可以进行80个类别的分类，但是通过改写网络说不定可以。</p>
<p>不过我还是试了一下，使用4000+张图片，2200+个文字分类进行训练，训练到18轮<code>mAP</code>还是0，所以自动就终止训练了，我推测可能是数据集太少，因为类别较多，相应的每个类别对应的图片数量就比较少了，所以不足以神经网络来提取特征。但是目前没有办法获取更多的数据集，所以没有进行下一步的工作。</p>
<p>按照之前字符验证码的训练经验，<strong>针对每个字符至少要有100个样本</strong>，这里<code>4000x5/2200</code>，平均每个字只有不到10个样本，并且文字又比字母和数字复杂的多！</p>
<h4 id="第二步：返回相应文字的坐标（像素点）"><a href="#第二步：返回相应文字的坐标（像素点）" class="headerlink" title="第二步：返回相应文字的坐标（像素点）"></a>第二步：返回相应文字的坐标（像素点）</h4><p>下面是在实践上述部分操作时，针对<code>pytorch-yolov3</code>框架的使用记录和一些其他的技术。</p>
<h3 id="pytorch-yolov3修改anchor-box尺寸和数量"><a href="#pytorch-yolov3修改anchor-box尺寸和数量" class="headerlink" title="pytorch-yolov3修改anchor box尺寸和数量"></a><code>pytorch-yolov3</code>修改anchor box尺寸和数量</h3><p>针对上面方案二的第一步，因为验证码图片大小固定，且文字大小差距也不大，所以anchor box的尺寸只需要3种大小就够了，所以这里尝试了下要做哪些调整</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[convolutional]</span><br><span class="line">size=1</span><br><span class="line">stride=1</span><br><span class="line">pad=1</span><br><span class="line">filters=18 --&gt; 6  共三处</span><br><span class="line">activation=linear</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[yolo]</span><br><span class="line">mask = 6,7,8  --&gt; 2</span><br><span class="line">anchors = 31,29, 36,35, 39,38   共三处</span><br><span class="line">classes=1</span><br><span class="line">num=9 -- &gt; 3   共三处</span><br><span class="line">jitter=.3</span><br><span class="line">ignore_thresh = .7</span><br><span class="line">truth_thresh = 1</span><br><span class="line">random=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">mask = 3,4,5 --&gt; 1</span><br><span class="line">......</span><br><span class="line">mask = 0,1,2 --&gt; 0</span><br></pre></td></tr></table></figure>
<p>filters = x*(classes+5)，x表示每个尺寸的特征图对应的anchor box大小。</p>
<p><code>yolov3</code> 原本是输出三个尺寸的特征图，且共有9种尺寸的anchor box，相当于每个尺寸的特征图平均分得3种尺寸的anchor box，当把anchor box尺寸数量改为3，那么x就等于1了。</p>
<h4 id="多分类配置cfg文件"><a href="#多分类配置cfg文件" class="headerlink" title="多分类配置cfg文件"></a>多分类配置<code>cfg</code>文件</h4><p>共2293个文字，也就是2293个分类</p>
<p>需要修改这两个值，共三处；x=1,<code>fliters=1*(2293+5)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">filters=2298 </span><br><span class="line">classes = 2293</span><br></pre></td></tr></table></figure>
<h3 id="Resize图片"><a href="#Resize图片" class="headerlink" title="Resize图片"></a>Resize图片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">img = cv2.imread(<span class="string">"VOC2007/JPEGImages/1-1.jpg"</span>)</span><br><span class="line">height, width = img.shape[:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义缩放信息 以等比例将高缩放到416为例，宽不固定</span></span><br><span class="line">scale = <span class="number">416</span>/height</span><br><span class="line">height = <span class="number">416</span></span><br><span class="line">width = int(width*scale)</span><br><span class="line"></span><br><span class="line">img = cv2.resize(img, (width, height))</span><br><span class="line">cv2.imwrite(<span class="string">"1-1-new.jpg"</span>, img)</span><br></pre></td></tr></table></figure>
<h3 id="切割图片"><a href="#切割图片" class="headerlink" title="切割图片"></a>切割图片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">img_old = Image.open(<span class="string">"VOC2007/JPEGImages/1-1.jpg"</span>)</span><br><span class="line"><span class="comment"># 剪裁出一块</span></span><br><span class="line">img_new = img_old.crop((<span class="number">0</span>, <span class="number">0</span>, <span class="number">320</span>, <span class="number">160</span>))  <span class="comment"># 左上角和右下角坐标</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将Image对象转换为二进制流</span></span><br><span class="line">img_byte = BytesIO()</span><br><span class="line">img_new.save(img_byte, format=<span class="string">'PNG'</span>)</span><br><span class="line">captcha_content = img_byte.getvalue()</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">rf'1-1-new.jpg'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> fw:</span><br><span class="line">    fw.write(captcha_content)</span><br></pre></td></tr></table></figure>
<h3 id="读写-xml"><a href="#读写-xml" class="headerlink" title="读写 xml"></a>读写 <code>xml</code></h3><ul>
<li>读取标注文件，并修改坐标信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xml.dom.minidom</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dom = xml.dom.minidom.parse(<span class="string">"VOC2007/Annotations/1-1.xml"</span>)</span><br><span class="line">root = dom.documentElement</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取标注目标框</span></span><br><span class="line">objects = root.getElementsByTagName(<span class="string">"bndbox"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> object <span class="keyword">in</span> objects:</span><br><span class="line">    xmin = object.getElementsByTagName(<span class="string">"xmin"</span>)</span><br><span class="line">    xmin_data = int(float(xmin[<span class="number">0</span>].firstChild.data))</span><br><span class="line">    <span class="comment"># xmin[0].firstChild.data =str(int(xmin1 * x))</span></span><br><span class="line">    ymin = object.getElementsByTagName(<span class="string">"ymin"</span>)</span><br><span class="line">    ymin_data = int(float(ymin[<span class="number">0</span>].firstChild.data))</span><br><span class="line">    xmax = object.getElementsByTagName(<span class="string">"xmax"</span>)</span><br><span class="line">    xmax_data = int(float(xmax[<span class="number">0</span>].firstChild.data))</span><br><span class="line">    ymax = object.getElementsByTagName(<span class="string">"ymax"</span>)</span><br><span class="line">    ymax_data = int(float(ymax[<span class="number">0</span>].firstChild.data))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 更新xml</span></span><br><span class="line">    width_xml = root.getElementsByTagName(<span class="string">"width"</span>)</span><br><span class="line">    width_xml[<span class="number">0</span>].firstChild.data = width</span><br><span class="line">    height_xml = root.getElementsByTagName(<span class="string">"height"</span>)</span><br><span class="line">    height_xml[<span class="number">0</span>].firstChild.data = height</span><br><span class="line"></span><br><span class="line">    xmin[<span class="number">0</span>].firstChild.data = int(xmin_data*scale)</span><br><span class="line">    ymin[<span class="number">0</span>].firstChild.data = int(ymin_data*scale)</span><br><span class="line">    xmax[<span class="number">0</span>].firstChild.data = int(xmax_data*scale)</span><br><span class="line">    ymax[<span class="number">0</span>].firstChild.data = int(ymax_data*scale)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 另存更新后的文件</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'1-1-new.xml'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        dom.writexml(f, addindent=<span class="string">'  '</span>, encoding=<span class="string">'utf-8'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>自己编写标注文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># write_info为一个列表，五个元素分别为物体name和xmin、ymin、xmax、ymax</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_xml</span><span class="params">(count, write_info)</span>:</span></span><br><span class="line">    <span class="comment"># 新建xml文档对象</span></span><br><span class="line">    xml = minidom.Document()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建第一个节点，第一个节点就是根节点了</span></span><br><span class="line">    annotation = xml.createElement(<span class="string">'annotation'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建节点后，还需要添加到文档中才有效</span></span><br><span class="line">    xml.appendChild(annotation)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 一般根节点是很少写文本内容，那么给根节点再创建一个子节点</span></span><br><span class="line">    folder = xml.createElement(<span class="string">'folder'</span>)</span><br><span class="line">    annotation.appendChild(folder)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 给这个节点加入文本，文本也是一种节点</span></span><br><span class="line">    text = xml.createTextNode(<span class="string">'images'</span>)</span><br><span class="line">    folder.appendChild(text)</span><br><span class="line"></span><br><span class="line">    filename = xml.createElement(<span class="string">'filename'</span>)</span><br><span class="line">    annotation.appendChild(filename)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># filename写入的值待定</span></span><br><span class="line">    text = xml.createTextNode(<span class="string">f"test<span class="subst">&#123;count&#125;</span>.jpg"</span>)</span><br><span class="line">    filename.appendChild(text)</span><br><span class="line"></span><br><span class="line">    source = xml.createElement(<span class="string">'source'</span>)</span><br><span class="line">    annotation.appendChild(source)</span><br><span class="line">    database = xml.createElement(<span class="string">'database'</span>)</span><br><span class="line">    source.appendChild(database)</span><br><span class="line"></span><br><span class="line">    text = xml.createElement(<span class="string">'Unknown'</span>)</span><br><span class="line">    database.appendChild(text)</span><br><span class="line"></span><br><span class="line">    size = xml.createElement(<span class="string">'size'</span>)</span><br><span class="line">    annotation.appendChild(size)</span><br><span class="line">    width = xml.createElement(<span class="string">'width'</span>)</span><br><span class="line">    size.appendChild(width)</span><br><span class="line">    text = xml.createTextNode(<span class="string">'320'</span>)</span><br><span class="line">    width.appendChild(text)</span><br><span class="line"></span><br><span class="line">    height = xml.createElement(<span class="string">'height'</span>)</span><br><span class="line">    size.appendChild(height)</span><br><span class="line">    text = xml.createTextNode(<span class="string">'160'</span>)</span><br><span class="line">    height.appendChild(text)</span><br><span class="line"></span><br><span class="line">    depth = xml.createElement(<span class="string">'depth'</span>)</span><br><span class="line">    size.appendChild(depth)</span><br><span class="line">    text = xml.createTextNode(<span class="string">'3'</span>)</span><br><span class="line">    depth.appendChild(text)</span><br><span class="line"></span><br><span class="line">    segmented = xml.createElement(<span class="string">'segmented'</span>)</span><br><span class="line">    annotation.appendChild(segmented)</span><br><span class="line">    text = xml.createTextNode(<span class="string">'0'</span>)</span><br><span class="line">    segmented.appendChild(text)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> info <span class="keyword">in</span> write_info:</span><br><span class="line">        xml_object = xml.createElement(<span class="string">'object'</span>)</span><br><span class="line">        annotation.appendChild(xml_object)</span><br><span class="line"></span><br><span class="line">        name = xml.createElement(<span class="string">'name'</span>)</span><br><span class="line">        xml_object.appendChild(name)</span><br><span class="line">        text = xml.createTextNode(str(info[<span class="number">0</span>]))</span><br><span class="line">        name.appendChild(text)</span><br><span class="line"></span><br><span class="line">        pose = xml.createElement(<span class="string">'pose'</span>)</span><br><span class="line">        xml_object.appendChild(pose)</span><br><span class="line">        text = xml.createTextNode(<span class="string">'Unspecified'</span>)</span><br><span class="line">        pose.appendChild(text)</span><br><span class="line"></span><br><span class="line">        truncated = xml.createElement(<span class="string">'truncated'</span>)</span><br><span class="line">        xml_object.appendChild(truncated)</span><br><span class="line">        text = xml.createTextNode(<span class="string">'0'</span>)</span><br><span class="line">        truncated.appendChild(text)</span><br><span class="line"></span><br><span class="line">        difficult = xml.createElement(<span class="string">'difficult'</span>)</span><br><span class="line">        xml_object.appendChild(difficult)</span><br><span class="line">        text = xml.createTextNode(<span class="string">'0'</span>)</span><br><span class="line">        difficult.appendChild(text)</span><br><span class="line"></span><br><span class="line">        bndbox = xml.createElement(<span class="string">'bndbox'</span>)</span><br><span class="line">        xml_object.appendChild(bndbox)</span><br><span class="line"></span><br><span class="line">        xmin = xml.createElement(<span class="string">'xmin'</span>)</span><br><span class="line">        bndbox.appendChild(xmin)</span><br><span class="line">        text = xml.createTextNode(str(info[<span class="number">1</span>]))</span><br><span class="line">        xmin.appendChild(text)</span><br><span class="line"></span><br><span class="line">        ymin = xml.createElement(<span class="string">'ymin'</span>)</span><br><span class="line">        bndbox.appendChild(ymin)</span><br><span class="line">        text = xml.createTextNode(str(info[<span class="number">2</span>]))</span><br><span class="line">        ymin.appendChild(text)</span><br><span class="line"></span><br><span class="line">        xmax = xml.createElement(<span class="string">'xmax'</span>)</span><br><span class="line">        bndbox.appendChild(xmax)</span><br><span class="line">        text = xml.createTextNode(str(info[<span class="number">3</span>]))</span><br><span class="line">        xmax.appendChild(text)</span><br><span class="line"></span><br><span class="line">        ymax = xml.createElement(<span class="string">'ymax'</span>)</span><br><span class="line">        bndbox.appendChild(ymax)</span><br><span class="line">        text = xml.createTextNode(str(info[<span class="number">4</span>]))</span><br><span class="line">        ymax.appendChild(text)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存文档</span></span><br><span class="line">    f = open(<span class="string">f'xml/test<span class="subst">&#123;count&#125;</span>.xml'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    xml.writexml(f, addindent=<span class="string">' \n'</span>)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>
<h3 id="OCR"><a href="#OCR" class="headerlink" title="OCR"></a>OCR</h3><p>光学字符识别（Optical Character Recognition，OCR）。</p>
<h4 id="传统OCR方法的一般流程"><a href="#传统OCR方法的一般流程" class="headerlink" title="传统OCR方法的一般流程"></a>传统OCR方法的一般流程</h4><p>图像输入</p>
<p>图像预处理：主要包括二值化、去噪声、倾斜校正等；</p>
<p>版面分析</p>
<p>字符切割</p>
<p>字符识别</p>
<p>版面恢复：按照原文档图片的顺序排列；</p>
<p>后处理：根据语言模型，对识别的结果进行语义校正。</p>
<p>缺点：整个处理流程工序太多，而且是串行的，导致错误不断被传递放大。例如，每一步都是90%的正确率，正确率看似很高，但是经过五步的错误叠加之后为0.59049，结果就已经不合格。另外，整个处理过程涉及太多人工设计，人工设计难以抓住问题的本质，而且面对稍复杂的问题，难以应对，泛化能力弱。</p>
<h4 id="基于深度学习OCR方法的一般流程"><a href="#基于深度学习OCR方法的一般流程" class="headerlink" title="基于深度学习OCR方法的一般流程"></a>基于深度学习OCR方法的一般流程</h4><p>主要分为两个步骤</p>
<p>文本检测（定位文本的位置）</p>
<p>文本识别（识别文本的具体内容）</p>
<p>文本检测的主流方法主要包含：基于候选框（Anchor）的文本检测、基于语义分割（Segmentation）的文本检测，以及基于两种方法的混合方法（Hybrid）。</p>
<p>文本识别的常用框架主要有两个：即<code>CNN+RNN+CTC</code>和<code>CNN+Seq2Seq+Attention</code>。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/deep-learning/" rel="tag"># deep learning</a>
          
            <a href="/tags/pytorch/" rel="tag"># pytorch</a>
          
            <a href="/tags/yolov3/" rel="tag"># yolov3</a>
          
            <a href="/tags/模板匹配/" rel="tag"># 模板匹配</a>
          
            <a href="/tags/OCR/" rel="tag"># OCR</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/07/23/dl-pytorch-yolov3/" rel="next" title="Pytorch-yolov3项目使用总结">
                <i class="fa fa-chevron-left"></i> Pytorch-yolov3项目使用总结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/08/28/dl-crnn/" rel="prev" title="利用CRNN进行文字识别">
                利用CRNN进行文字识别 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.png" alt="chenxi">
            
              <p class="site-author-name" itemprop="name">chenxi</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">114</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">209</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://docle.github.io/" title="Docle" target="_blank">Docle</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://transformerswsz.github.io/" title="Swift" target="_blank">Swift</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#关于中文点选验证码的识别"><span class="nav-text">关于中文点选验证码的识别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#背景描述"><span class="nav-text">背景描述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#无语序要求"><span class="nav-text">无语序要求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#有语序要求"><span class="nav-text">有语序要求</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解决方案"><span class="nav-text">解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方案一："><span class="nav-text">方案一：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一步：先定位文字，也就是仅做目标检测，所有文字认为是1类"><span class="nav-text">第一步：先定位文字，也就是仅做目标检测，所有文字认为是1类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二步：对定位区域进行切割（把字抠出来），单个文字进行识别"><span class="nav-text">第二步：对定位区域进行切割（把字抠出来），单个文字进行识别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第三步：返回相应文字的坐标（像素点）"><span class="nav-text">第三步：返回相应文字的坐标（像素点）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方案二："><span class="nav-text">方案二：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一步：定位-分类同时实现，那就要做一个几千个类别的目标检测和分类模型"><span class="nav-text">第一步：定位+分类同时实现，那就要做一个几千个类别的目标检测和分类模型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二步：返回相应文字的坐标（像素点）"><span class="nav-text">第二步：返回相应文字的坐标（像素点）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pytorch-yolov3修改anchor-box尺寸和数量"><span class="nav-text">pytorch-yolov3修改anchor box尺寸和数量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#多分类配置cfg文件"><span class="nav-text">多分类配置cfg文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Resize图片"><span class="nav-text">Resize图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#切割图片"><span class="nav-text">切割图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读写-xml"><span class="nav-text">读写 xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OCR"><span class="nav-text">OCR</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#传统OCR方法的一般流程"><span class="nav-text">传统OCR方法的一般流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基于深度学习OCR方法的一般流程"><span class="nav-text">基于深度学习OCR方法的一般流程</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenxi</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
